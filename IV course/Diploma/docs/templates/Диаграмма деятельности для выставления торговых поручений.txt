@startuml
start

:Определить режим (песочница или реальный рынок);

if (sandbox_method?) then (да)
    :Получить аккаунт из Sandbox;
else (нет)
    :Получить аккаунт из обычного клиента;
endif

if (operation == "buy") then (да)
    :Проверить наличие позиции в портфеле;

    if (Позиция уже есть?) then (да)
        :Выход (ожидание сигнала к продаже);
        stop
    endif

    :Получить текущую цену покупки;

    :Проверить достаточность средств;

    if (Средств достаточно?) then (да)
        :Сгенерировать order_id;
        :Создать лимитную заявку на покупку;
        :Сохранить ордер в БД (через trading_client);
        :Логирование заявки;
    else (нет)
        :Выход (недостаточно средств);
    endif

else (нет)
    if (operation == "sell") then (да)
        :Проверить наличие позиции в портфеле;

        if (Позиции нет?) then (да)
            :Выход (ожидание сигнала к покупке);
            stop
        endif

        :Получить текущую цену продажи;
        :Сгенерировать order_id;
        :Создать лимитную заявку на продажу;
        :Сохранить ордер в БД (через trading_client);
        :Логирование заявки;
    endif
endif

stop
@enduml
