@startuml
start

title Диаграмма деятельности: Работа стратегии

:Загрузить переменные окружения;
:Получить токен и флаг песочницы;

:Получить инструменты пользователя;
if (Инструменты есть?) then (да)
  :Получить конфигурацию стратегии;
  if (Конфигурация есть?) then (да)
    :Для каждого инструмента получить его FIGI-идентификатор;
    :Получить текущую прибыль для актива;
    :Получить сигналы для каждого актива (BUY/SELL/HOLD);
    :Проверить условие логического оператора стратегии;
    :Проверить условие на автоматическую торговлю;
    if (Автоматическая торговля?) then (да)
      :Завершить заявку по инструменту (если была);
      :Разместить новую торговую заявку;
    else (нет)
      :Сформировать рекомендацию для пользователя;
    endif
    :Оповестить пользователя;
  else (нет)
    :Вернуть сообщение: Конфигурация стратегии пуста;
  endif
else (нет)
  :Вернуть сообщение: У пользователя нет инструментов;
endif

stop
@enduml
